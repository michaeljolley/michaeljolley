---
const { filename, alt, class: classes } = Astro.props;
const srcs = ["240", "400", "800", "1200"];
let image = filename;
const ext = image.split(".").pop();
let webp = undefined;
let orig = undefined;
if (image.indexOf("cloudinary") > -1) {
  webp = srcs
    .map((src) => {
      const url = image
        .replace("upload/", `upload/w_${src},c_scale,f_auto/`)
        .replace(`.${ext}`, ".webp");
      return `${url} ${src}w`;
    })
    .join(", ");
  orig = srcs
    .map((src) => {
      const url = image.replace("upload/", `upload/w_${src},c_scale,f_auto/`);
      return `${url} ${src}w`;
    })
    .join(", ");
}
if (image.indexOf("storyblok.com") > -1) {
  image = `${image}/m/`;
}
---

<picture class={classes} loading="auto">
  {
    webp && (
      <source loading="auto" srcset={webp} type="image/webp" sizes="33.3vw" />
    )
  }
  {
    orig && (
      <source
        loading="auto"
        srcset={orig}
        type={`image/${ext}`}
        sizes="33.3vw"
      />
    )
  }
  <img loading="auto" class={classes} src={image} alt={alt} />
</picture>
